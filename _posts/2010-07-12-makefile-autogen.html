--- 
status: publish
layout: post
title: !binary |
  566A5Y2V5bel56iLTWFrZWZpbGXnmoToh6rliqjnlJ/miJA=

meta: 
  _jd_wp_twitter: "Post Edited: \xE7\xAE\x80\xE5\x8D\x95\xE5\xB7\xA5\xE7\xA8\x8BMakefile\xE7\x9A\x84\xE8\x87\xAA\xE5\x8A\xA8\xE7\x94\x9F\xE6\x88\x90 http://huangjian.info/228/makefile-autogen/"
  _wp_jd_bitly: ""
  _wp_jd_clig: ""
  _wp_jd_wp: http://huangjian.info/228/makefile-autogen/
  _wp_old_slug: "%e7%ae%80%e5%8d%95%e5%b7%a5%e7%a8%8bmakefile%e7%9a%84%e8%87%aa%e5%8a%a8%e7%94%9f%e6%88%90"
  _edit_last: "1"
  _wp_jd_yourls: ""
  _wp_jd_target: http://huangjian.info/228/makefile-autogen/
  _jd_post_meta_fixed: "true"
  _wp_jd_url: ""
  _jd_twitter: ""
  _jd_tweet_this: "yes"
tags: 
- enginer
- makefile
- Technics
published: true
type: post
---
工程Makefile的编写，可以自己动手来写，也可以使用automake等工具来自动生成。下面还是以sort工程为例，对自动生成Makefle进行示例说明。</br>
</br>
预备知识:</br>
</br>
运用GNU Autoconf 及 Automake 这两套工具，可以自动生成Makefile文件，并且让开发出来的软件可以像大多数源码包那样，只需"./configure", "make","make install" 就可以把程序安装到系统中。</br>
</br>
autoconf是一个用于生成可以自动地配置软件源码包，用以适应多种UNIX类系统的shell脚本工具，其中autoconf需要用到 m4，便于生成脚本。</br>
</br>
<!--more--></br>
</br>
automake是一个从Makefile.am文件自动生成Makefile.in的工具。为了生成 Makefile.in， automake还需用到perl。</br>
</br>
工程sort，Makefile的生成，需要以下几步：</br>
</br>
1) 运行autoscan命令</br>
</br>
2) 将configure.scan 更名为configure.in，并修改configure.in文件</br>
</br>
3) 在sort根目录下新建Makefile.am文件，并在各个模块子目录下也新建makefile.am文件</br>
</br>
4) 在sort根目录下新建NEWS、 README、 ChangeLog 、AUTHORS文件</br>
</br>
5) 运行aclocal命令</br>
</br>
6) 运行autoconf命令</br>
</br>
7) 运行automake -a命令</br>
</br>
8) 运行./confiugre,生成Makefile</br>
</br>
准备工作：</br>
</br>
安装automake。自动生成Makefile，需要编译环境安装有autoconf和automake，若没有安装，在ubuntu下可以这样来安装：</br>
</br>
root@mygirl:/study/sort# apt-get install automake</br>
</br>
源文件：</br>
</br>
本例工程，实现几种排序算法的具体代码实现和性能比较。工程原始文件结构如下：</br>
</br>
sort</br>
</br>
|-- main</br>
</br>
|   |-- include</br>
</br>
|   |   |-- heap_sort.h</br>
</br>
|   |   |-- quick_sort.h</br>
</br>
|   |   `-- shell_sort.h</br>
</br>
|   |-- libs</br>
</br>
|   `-- src</br>
</br>
|       `-- sort.c</br>
</br>
|-- heap_sort</br>
</br>
|   |-- include</br>
</br>
|   `-- src</br>
</br>
|       `-- heap_sort.c</br>
</br>
|-- quick_sort</br>
</br>
|   |-- include</br>
</br>
|   `-- src</br>
</br>
|       `-- quick_sort.c</br>
</br>
`-- shell_sort</br>
</br>
|-- include</br>
</br>
`-- src</br>
</br>
`-- shell_sort.c</br>
</br>
Let's do it！</br>
</br>
首先进入sort根目录，状态如下：</br>
</br>
root@mygirl:/study/sort# ls</br>
</br>
heap_sort main quick_sort shell_sort</br>
</br>
运行autoscan</br>
</br>
root@mygirl:/study/sort# autoscan</br>
</br>
root@mygirl:/study/sort# ls</br>
</br>
autoscan.log configure.scan heap_sort main quick_sort shell_sort</br>
</br>
可以看到，文件夹下多出了两个文件:autoscan.log,configure.scan。之后，我们需要将configure.scan更名为configure.in，并进行更改：</br>
</br>
root@mygirl:/study/sort# mv configure.scan configure.in root@mygirl:/study/sort# vim configrue.in</br>
</br>
更改后的文件，内容如下：</br>
</br>
#                                               -*- Autoconf -*-</br>
</br>
# Process this file with autoconf to produce a configure script.</br>
</br>
AC_PREREQ(2.61)</br>
</br>
AC_INIT(sort, 1.0, jiangpeifu@gmail.com)</br>
</br>
AC_CONFIG_SRCDIR([heap_sort/src/heap_sort.c])</br>
</br>
AC_CONFIG_HEADER([config.h])</br>
</br>
AM_INIT_AUTOMAKE(sort,1.0)</br>
</br>
# Checks for programs.</br>
</br>
AC_PROG_CC</br>
</br>
# Checks for libraries.</br>
</br>
AC_PROG_RANLIB+=RANLIB</br>
</br>
# Checks for header files.</br>
</br>
AC_HEADER_STDC</br>
</br>
AC_CHECK_HEADERS([stdlib.h])</br>
</br>
# Checks for typedefs, structures, and compiler characteristics.</br>
</br>
AC_HEADER_TIME</br>
</br>
# Checks for library functions.</br>
</br>
AC_CHECK_FUNCS([gettimeofday])</br>
</br>
AC_OUTPUT([Makefile</br>
</br>
heap_sort/Makefile</br>
</br>
quick_sort/Makefile</br>
</br>
shell_sort/Makefile</br>
</br>
main/Makefile</br>
</br>
])</br>
</br>
文件中，红色的为改动的内容。</br>
</br>
在根目录下添加Makefile.am 文件：</br>
</br>
root@mygirl:/study/sort# vim Makefile.am</br>
</br>
Makefile.am的内容如下：</br>
</br>
SUBDIRS=quick_sort heap_sort shell_sort main</br>
</br>
INCLUDES=-I./include</br>
</br>
export INCLUDES</br>
</br>
在main目录下添加Makefile.am 文件：</br>
</br>
root@mygirl:/study/sort# cd main</br>
</br>
root@mygirl:/study/sort/main# vim Makefile.am</br>
</br>
Makefile.am的内容如下：</br>
</br>
noinst_PROGRAMS=sort</br>
</br>
INCLUDES=-I./include</br>
</br>
sort_SOURCES=./src/sort.c</br>
</br>
sort_LDADD=$(top_srcdir)/heap_sort/libheap_sort.a \</br>
</br>
$(top_srcdir)/shell_sort/libshell_sort.a \</br>
</br>
$(top_srcdir)/quick_sort/libquick_sort.a</br>
</br>
在heap_sort目录下添加Makefile.am 文件：</br>
</br>
root@mygirl:/study/sort# cd heap_sort</br>
</br>
root@mygirl:/study/sort/heap_sort# vim Makefile.am</br>
</br>
Makefile.am的内容如下：</br>
</br>
INCLUDES=-I./include</br>
</br>
noinst_LIBRARIES=libheap_sort.a</br>
</br>
libheap_sort_a_SOURCES=./src/heap_sort.c</br>
</br>
在quick_sort目录下添加Makefile.am 文件：</br>
</br>
root@mygirl:/study/sort# cd quick_sort</br>
</br>
root@mygirl:/study/sort/quick_sort# vim Makefile.am</br>
</br>
Makefile.am的内容如下：</br>
</br>
INCLUDES=-I./include</br>
</br>
noinst_LIBRARIES=libquick_sort.a</br>
</br>
libquick_sort_a_SOURCES=./src/quick_sort.c</br>
</br>
在shell_sort目录下添加Makefile.am 文件：</br>
</br>
root@mygirl:/study/sort# cd shell_sort</br>
</br>
root@mygirl:/study/sort/shell_sort# vim Makefile.am</br>
</br>
Makefile.am的内容如下：</br>
</br>
INCLUDES=-I./include</br>
</br>
noinst_LIBRARIES=libshell_sort.a</br>
</br>
libshell_sort_a_SOURCES=./src/shell_sort.c</br>
</br>
在根目录下添加如下文件：NEWS，README，ChangeLog，AUTHORS，config.h.in：</br>
</br>
root@mygirl:/study/sort# touch NEWS README ChangeLog AUTHORS config.h.in</br>
</br>
这些文件的内容可以自己编写，我们这里文件内容均为空。</br>
</br>
运行aclocal，和autoconf命令：</br>
</br>
root@mygirl:/study/sort# aclocal</br>
</br>
root@mygirl:/study/sort# autoconf</br>
</br>
运行automake -a：</br>
</br>
root@mygirl:/study/sort# automake -a</br>
</br>
root@mygirl:/study/sort# ls</br>
</br>
aclocal.m4 autom4te.cache ChangeLog    configure     COPYING heap_sort install-sh Makefile.am missing quick_sort shell_sort</br>
</br>
AUTHORS     autoscan.log    config.h.in configure.in depcomp INSTALL    main        Makefile.in NEWS     README</br>
</br>
看到，根目录下多生成文件Makefile.in。在子模块main等目录下也生成了Makefile.in。</br>
</br>
运行./configure:</br>
</br>
root@mygirl:/study/sort# ./configure</br>
</br>
root@mygirl:/study/sort# ls</br>
</br>
aclocal.m4      autoscan.log config.h.in    configure     depcomp    install-sh Makefile.am NEWS        shell_sort</br>
</br>
AUTHORS         ChangeLog     config.log     configure.in heap_sort main        Makefile.in quick_sort stamp-h1</br>
</br>
autom4te.cache config.h      config.status COPYING       INSTALL    Makefile    missing      README</br>
</br>
这样就生成了工程sort的Makefile。</br>
</br>
在根目录下运行make，可以编译工程；运行make install可以安装编译的文件；运行make dist，可以生成源码压缩包。</br>
</br>
至此一切OK！！
